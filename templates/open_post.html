<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
          integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js"
            integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM"
            crossorigin="anonymous"></script>

    <title>글 열람 페이지</title>

    <style>
        .header_image {
            width: 100%;
            height: 250px;

            background-image: linear-gradient(0deg, rgba(0, 0, 0, 0.5), rgba(0, 0, 0, 0.5)), url('https://www.seouledu.or.kr/images/contents/business03_imgTitleBox.jpg');
            background-position: center;
            background-size: cover;

            display: flex;
            flex-direction: row;
            align-items: center;
            justify-content: center;
        }

        .row{
            width: 1000px;
            max-width: 1000px;
            max-height: 100%;
            margin: 20px auto 0px auto;
            padding: 20px;
        }

        textarea{
            width: 450px;
            height: 300px;
        }
    </style>
    <script>
        $(document).ready(function () {
            $('#footer').load("/footer.html");
        })

        //댓글 textarea 키보드 동작에 따라 댓글 창 넓히기
        function xSize(e){
            e.style.height = '1px';
            e.style.height = (e.scrollHeight + 12) + 'px';
        }

        function comment_write(){
            //로그인된 계정의 아이디 및 닉네임값을 열람페이지까지 가지고 와서 댓글 작성자의 닉네임 혹은 아이디를 넣어주도록 수정한다,
            //지금은 계정이 로그인되었다고 가정하고 고정값을 넣어준다.
            //댓글 작성자는 닉네임으로 나타나도록 하는 것이 좋을 듯하다.
            let user_id = "wlstpgns51@naver.com";
            let nickname = "진진";
            let comment = $('#comment').val();

             $.ajax({
                type: "POST",
                url: "/udongdong/comment_write",
                data: {
                    user_id: user_id,
                    nickname: nickname,
                    comment: comment
                },
                success: function (response) {
                    alert("댓글 작성 완료!");

                    let comments_list = response['comments_list'];

                    for(let i = 0 ; i < comments_list.length ; i++){
                        let nick = comments_list[i]['nick'];
                        let comment = comments_list[i]['comment'];

                        let comment_html = `<tr>
                                                <th>${nick}</th>
                                                <td>${comment}</td>
                                            </tr>`;

                        $('#comment_list').append(comment_html);
                    }
                }
            })
        }
    </script>
</head>

<body>
    <div class="header_image"></div>

    <div class="row row-cols-1 row-cols-md-1 g-4">
        <div class="post_box">
            <div class="mb-3">
                <label for="exampleFormControlInput1" class="form-label">동호회 이름 : {{group_name}}</label><br>
                <label for="exampleFormControlInput2" class="form-label">지역 : {{address}}</label><br>
                <label for="exampleFormControlInput3" class="form-label">작성자 : {{id}}</label><hr>
                <input type="hidden" id="id" value="{{id}}">
                <label for="exampleFormControlTextarea1" class="form-label">작성글</label>
                <img src="{{img}}" class="card-img-top" weight="300" height="400">
                <textarea class="form-control" id="write_content" rows="5" readonly>
                    {{content}}
                </textarea>
            </div>

            <p>로그인된 계정의 닉네임 (nickname)</p>
            <div class="input-group mb-3">
              <textarea id="comment" class="form-control" onkeyup="xSize(this)" style="height:53px; overflow-y:hidden" placeholder="댓글 입력" aria-label="Recipient's username" aria-describedby="button-addon2"></textarea>
              <button class="btn btn-outline-secondary" type="button" onclick="comment_write()">등록</button>
            </div>

            <div id="comment_wrap">
                <table class="table">
                    <thead>
                    <tr>
                        <th scope="col">작성자</th>
                        <th scope="col">댓글</th>
                    </tr>
                    </thead>
                    <tbody id="comment_list">
<!--                    <tr>-->
<!--                        <th></th>-->
<!--                        <td></td>-->
<!--                    </tr>-->
                    </tbody>
                </table>
            </div>
        </div>
    </div>

<div id="footer"></div>
</body>
</html>